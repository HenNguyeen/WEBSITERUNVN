
@model IEnumerable<DBStoreSport.Models.Product>

@{
    ViewBag.Title = "Mua Hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
    .filter-card {
        border-radius: 16px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        border: none;
        background: #fffbe7;
    }

    .product-card {
        border-radius: 16px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        border: none;
        transition: box-shadow 0.2s;
    }

        .product-card:hover {
            box-shadow: 0 6px 24px rgba(0,0,0,0.13);
        }

    .product-img {
        border-radius: 12px 12px 0 0;
        object-fit: cover;
        width: 100%;
        height: 180px;
        background: #f8f9fa;
    }

    .product-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #0d6efd;
        margin-bottom: 0.3rem;
    }

    .product-price {
        color: #dc3545;
        font-weight: 600;
        font-size: 1.08rem;
    }

    .btn-buy, .btn-detail {
        border-radius: 20px;
        min-width: 80px;
        font-weight: 500;
    }

    .pagination .page-link {
        border-radius: 50% !important;
        margin: 0 2px;
    }
</style>

<div class="container mt-4 mb-5">
    <!-- Banner Carousel -->
    <div id="productBanner" class="carousel slide mb-4" data-bs-ride="carousel" style="border-radius:18px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,0.08);">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="~/Content/images/g10.jpg" class="d-block w-100" style="height:260px;object-fit:cover;" alt="Banner 1">
            </div>
            <div class="carousel-item">
                <img src="~/Content/images/g11.jpg" class="d-block w-100" style="height:260px;object-fit:cover;" alt="Banner 2">
            </div>
            <div class="carousel-item">
                <img src="~/Content/images/Pin7.jpg" class="d-block w-100" style="height:260px;object-fit:cover;" alt="Banner 3">
            </div>
            <div class="carousel-item">
                <img src="~/Content/images/Pin8.jpg" class="d-block w-100" style="height:260px;object-fit:cover;" alt="Banner 4">
            </div>
            <div class="carousel-item">
                <img src="~/Content/images/Pin9.jpg" class="d-block w-100" style="height:260px;object-fit:cover;" alt="Banner 5">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#productBanner" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#productBanner" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <!-- Bộ lọc tìm kiếm -->
    <div class="card filter-card p-4 mb-4">
        @using (Html.BeginForm("ProductList", "Products", FormMethod.Get))
        {
            <div class="row g-3 align-items-end justify-content-center">
                <div class="col-12 col-md-4">
                    <label class="form-label mb-1" for="searchInput"><i class="bi bi-search"></i> Tên sản phẩm</label>
                    <div class="input-group">
                        <input id="searchInput" type="text" name="SearchString" value="@Request["SearchString"]" class="form-control rounded-pill" placeholder="Tìm theo tên..." />
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <label class="form-label mb-1" for="minInput"><i class="bi bi-currency-exchange"></i> Khoảng giá</label>
                    <div class="input-group">
                        <input id="minInput" type="number" name="min" value="@Request["min"]" class="form-control rounded-start-pill" placeholder="Từ" min="0" />
                        <span class="input-group-text border-0 bg-white px-2">-</span>
                        <input type="number" name="max" value="@Request["max"]" class="form-control rounded-end-pill" placeholder="Đến" min="0" />
                    </div>
                </div>
                <div class="col-12 col-md-2 d-grid">
                    <button type="submit" class="btn btn-warning rounded-pill fw-bold"><i class="bi bi-funnel"></i> Lọc</button>
                </div>
            </div>
            <div class="mt-3 text-center">
                <strong>Sắp xếp theo:</strong>
                @Html.ActionLink("Tên ↑", "ProductList", new { sortOrder = "", SearchString = Request["SearchString"], min = Request["min"], max = Request["max"] }) |
                @Html.ActionLink("Tên ↓", "ProductList", new { sortOrder = "name_desc", SearchString = Request["SearchString"], min = Request["min"], max = Request["max"] }) |
                @Html.ActionLink("Giá ↑", "ProductList", new { sortOrder = "price", SearchString = Request["SearchString"], min = Request["min"], max = Request["max"] }) |
                @Html.ActionLink("Giá ↓", "ProductList", new { sortOrder = "price_desc", SearchString = Request["SearchString"], min = Request["min"], max = Request["max"] })
            </div>
        }
    </div>

    <!-- Danh sách sản phẩm -->
    <div class="row">
        @foreach (var pro in Model)
        {
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                <div class="card product-card h-100">
                    <img src="~/Content/images/@pro.ImagePro" class="product-img" alt="@pro.NamePro">
                    <div class="card-body d-flex flex-column">
                        <div class="product-title text-truncate">@pro.NamePro</div>
                        <div class="product-price mb-2">@pro.Price VNĐ</div>
                        <div class="text-muted mb-2">
                            <i class="bi bi-box-seam"></i> Số lượng:
                            <strong class="@(pro.Quantity <= 5 ? "text-danger" : "text-dark")">@pro.Quantity</strong> sản phẩm
                        </div>
                        <div class="mt-auto text-center">
                            <a href="/Products/Details/@pro.ProductID" class="btn btn-info btn-detail me-2"><i class="bi bi-info-circle"></i> Chi tiết</a>
                            @if (pro.Quantity > 0)
                            {
                                <a href="~/ShoppingCart/AddToCart/@pro.ProductID"
                                   class="btn btn-danger btn-buy">
                                    <i class="bi bi-cart-plus"></i> Mua
                                </a>
                            }
                            else
                            {
                                <a href="javascript:void(0);"
                                   class="btn btn-secondary btn-buy"
                                   onclick="alert('Sản phẩm đã hết hàng!'); return false;"
                                   title="Sản phẩm đã hết hàng">
                                    <i class="bi bi-cart-x"></i> Mua
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

</div>
<!-- Nút scroll to top -->
<button class="btn btn-primary scroll-to-top" aria-label="Scroll to top" style="display:none;"><i class="bi bi-arrow-up"></i></button>

<style>
    .scroll-to-top {
        position: fixed;
        bottom: 32px;
        right: 32px;
        z-index: 9999;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        background: #0d6efd;
        color: #fff;
        border: none;
        transition: opacity 0.2s;
    }
</style>
<script>
    // Ẩn/hiện nút khi cuộn
    window.addEventListener('scroll', function () {
        var btn = document.querySelector('.scroll-to-top');
        if (btn) btn.style.display = window.scrollY > 200 ? 'flex' : 'none';
    });
    // Cuộn lên đầu trang khi click
    document.addEventListener('DOMContentLoaded', function () {
        var btn = document.querySelector('.scroll-to-top');
        if (btn) btn.onclick = function () { window.scrollTo({ top: 0, behavior: 'smooth' }); };
    });
</script>